第一阶段主要目标是：基础架构调整
## 重构和优化效果
优化和整合初步完成，顺势修复DTO不统一、全局异常等问题。代码量减少为原来的2/3左右

## 指导思想
1. 极简主义的代码
1. 谨记过犹不及的道理，时刻避免"过度封装"。

> #### 耗费精力梳理这个文档原因
> 1. 分享重构和优化细节，使代码有迹可循，减少代码回归对比难度。
> 1. 优化工作需要其他同事参与，降低沟通成本。
> 1. 优化代码和重构是一种"很难看见”的工作；让领导和同事看到工作量；回答“这么长时间你都改了个啥？结果不显著啊，没看到啊？”类似的问题。

## 已完成工作（按照模块排序）
### 全局
1. 改造为“单工程多模块”结构，diamond-bom作为父工程这种网状结构，因为平级flat结构会发生找不到bom的问题。
    1. 同样支持按照不同模块发布jar包
    1. clone后可自动构建、运行、打包、热部署。
    1. 提高开发效率
        1. 整体架构一目了然
        1. 修改代码时候，比如修改类名，可以自动修改所有引用。而不是自己一个一个的手动修改
    1. 提高宣传效率
1. 所有模块TDF改为tdf小写开头，符合命名规范。
1. 支持lombok，全部模块的DTO、Domain等使用lombok。升级maven-compiler-plugin到3.1以后版本从而支持lombok。
1. 删除不必要的try catch，错误情况直接throw异常。修复统一异常机制。
1. 多模块工程，不再保留pom中的“common.version、sys.version”等等。 统一使用project.version，方便和简化统一构建和发布流程。
1. 普通jar包类型构建插件统一使用maven-jar-plugin。使用skipTests=true或者mvn动态传参方式跳过test。
1. 所有@Autowired改为@Autowired
1. 删除依赖管理webjars、spring-webmvc、jquery等
1. 删除依赖管理tdf-oauth-server、 diamond-oauth-client
1. diamond-security-cache-redis没有找到工程（与佳良确认，不需要移植，可以删除）
1. diamond-sys-cache-redis依赖暂时删除：http://gitlab.taiji.com.cn/IRI/Diamond-sys-cache-redis(佳良确定没有使用，是之前同事写得老代码)
1. diamond-sys-web-cache-redis依赖暂时删除：http://gitlab.taiji.com.cn/IRI/Diamond-sys-web-cache-redis(佳良确定没有使用，是之前同事写得老代码)
1. 所有模块readme.md整理
1. 删除SysConfigure中的上传文件目录配置
1. 所有模块取消依赖spring session，删除pom和代码等等。因为是前后端分离结构，并且security使用的是SessionCreationPolicy.STATELESS策略，所有不存在session。
1. swagger样式包替换为knife4j，删除swagger-bootstrap-ui,清理多余依赖。因为swagger-bootstrap-ui已经停止更新，新版本更名为knife4j
1. 清理所有模块test包，统一移动到tdf入口模块，统一测试。

### diamond-ui-vue
不需要做修改
1. 前端也加入到TDF Base目录里面来，Diamond-ui-vue只保留一份。

### diamond-common与tdf-util合并
1. pom依赖lombok，去掉optional=true，允许子工程依赖
1. 删除Audited、ResultStatusEnum、AjaxResultJson、BootStrapTreeState、BootStrapTreeViewDTO等多余DTO
1. Dto全部改为DTO，建立命名规范
1. 所有DTO禁止引用Domain,如RoleDTO,建立DTO规范
1. SearchRestDTO重命名为PageDTO
1. ResultDTO 与ResultSuccessDTO合并，简化ResultDTO使用方式，只需new ResultDTO(data)并结合统一异常机制即可。
1. 所有业务DTO统一继承BaseDTO，实现getSerialVersionUID方法
1. 所有DTO代码格式紊乱问题统一修复，如属性和getter setter穿插
1. MenuRouterDTO缺少serialVersionUID补齐
1. QueryAuthorityReq命名为QueryAuthorityDTO
1. 删除 commons-lang3 ，因为 spring-boot-dependencies 中已经有了。
1. 删除无用的 app.version
1. 删除无用的 custom.version
1. 删除无用的 log4j.version
1. 删除与spring冲突的 redis.version
1. 删除与spring冲突的 inject.version
1. 删除与spring冲突的 jsr250-api.version

### diamond-sys
1. sys依赖tdf-common，删除多余依赖如poi
1. diamond-sys的dto移动到tdf-common中
1. exception包删除，重构与统一异常合并,BusinessException、StorageException、StorageFileNotFoundException统一简化使用SysException
1. Audited不是一个util，所以移动到domain包，dto包中的Audited和util包下的Audited重复，合并为一个
1. 所有repository删除错误注释
1. 所有domain不规范代码格式整理,删除错误注释，多余换行，不对齐，缺少private
1. 删除import注释
1. 删除resources目录下无用的xml
1. excel包移动到tdf-common中，删除excel中错误的异常类，excel是处理电子表格的包，不应改放置exception
1. AuthorityServiceImpl 删除无用代码，简化if else逻辑。使用新的ResultDTO,使用统一异常机制，错误情况直接throw异常
1. DataItemService， DeptService, ParameterServiceImpl 删除无用代码，补充log。使用新的ResultDTO,使用统一异常机制，错误情况直接throw异常
1. UserService删除public，考虑统一service+impl的形式
1. diamond-cms依赖暂时删除、 diamond-cms-web依赖暂时删除、Diamond-log-method依赖暂时删除、diamond-log-type 没有找到工程(夏总已经确定，这些模块不用考虑)
1. relativePath指向兄弟目录不生效的问题（使用tdf bom作为父工程，不存在relativePath的问题）
1. 所有domain里面的equals和hashcode方法优化，抽取公共方法(不需要做，因为是JPA自动生成的代码)
1. test单元测试代码整理,删除不必要的代码，统一移动到tdf模块。因为是单工程结构，可以直接统一单元测试
1. util包中缓存相关，最优方式解析，移动到tdf的test测试参考代码中
1. CacheService移动到了tdf的test下

### diamond-security
1. DTO修改后影响到的代码配套修改

### diamond-sys-web
1. 删除所有未分离相关代码，如pom删除thymeleaf相关、spring-webmvc等。删除resources目录所有静态资源
1. 删除web、cloud目录下所有代码，只保留api目录下代码。
1. 所有返回错误DTO改为throw异常，走全局异常机制
1. 去掉所有try catch
1. FileUploadRestController删除与统一异常冲突的ExceptionHandler，代码整理
1. pom删除重复引用,如swagger2、commons等等

### diamond-log
1. 删除resources目录
1. WebLogsRestController删除try catch，走统一异常
1. 删除多余的SearchRestDTO，统一使用tdf-common的PageDTO
1. pom清理

### diamond-sample-jwt
1. diamond-base-platform中保留tdf，便于平台开发。同时外部保留tdf-sample-jwt，便于jar包依赖方式开发。
    1. 更名为tdf，作为平台内入口类，方便平台开发。
    1. diamond-sample-jwt的完全版本要保留在外部，方便用户以jar包形式开发。
1. tdf删除demo、api、exception默认包，保留平台代码简洁性。外部sample保留。
1. 删除怪异的org.hibernate.cfg.PropertyContainer(也许有问题，需要确认具体功能)
1. 统一为config后缀
1. CorsConfig优化、 SecurityConfig优化、RedisSessionConfig重命名
1. SysConfigure删除文件大小限制，使用配置文件的形式来控制。
1. 简化入口类配置，优化为@SpringBootApplication
