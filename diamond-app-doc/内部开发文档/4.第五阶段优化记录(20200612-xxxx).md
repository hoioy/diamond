## 第五阶段优化目标
1. 配合tdf-ui-vue前端重构，进行前后端统一优化
1. 进一步提高不分离版本tdf-union代码质量

## 已完成
1. ParameterInfoDTO属性杂乱需要优化
1. 删除不必要的Optional包装
1. 实现部分i18n，参考：https://howtodoinjava.com/spring-boot2/rest/i18n-internationalization/

## 未完成
#### 目前发现的bug
1. tdf security的默认白名单机制
1. 部门序号校验
1. 部门选中之后点空白地方应该置空

### 拟优化
1. 统一重写DTO上的swagger注解，使得接口描述更加清晰
    1. 接口排序,不同模块使用@Api的tag属性排序，统一模块中的接口@ApiOperationSupport
1. 数据权限校验相关：
    1. 优先级最高: menu逻辑优化，menu菜单分类,menu菜单接口优化
    1. menu重构，目前动态鉴权不支持GET、POST等等接口的动态鉴权逻辑
    1. 更好的实现方式研究
1. 统一异常返回code有没有更好的方式
1. PageDTO校验机制，关于dto中的validation注解，如：@Size(min=4, max=20, message="角色名长度只能在4-20之间")
1. mybatis版本初始化语句中确实唯一主键都要补全
1. 是否BaseXX系类抽取uploadExcel和DownloadExcel方法
1. jpa多表关联分页构造函数太复杂怎么办的问题

#### 前端和后端web层接口全面优化
1. list转tree逻辑移植到前端（后端仍然保留listToTree能力）
1. 前后端分离XSS攻击防护
1. 数据权限基础实现方案

#### 代码细节优化
1. 删除所有queryAll查询类型接口，理论上不支持queryAll查询
1. tdf-common中不应该有@Component类似的注解，防止用户单独依赖tdf-common时候自动注入不必要的对象而引起冲突问题。
1. 精简common模块中的Util类,目标是尽量删除Util，框架自己不维护Util
1. JPA的所有for循环内部调用数据库的全部改为batch类操作
1. jpa的@Param("xxxx") 考虑删除
1. BaseServiceImpl批量逻辑删除的性能问题
1. tdf-security模块拆分清晰后的注入IUserService和IMenuService方式优化。
1. tdf-security代码质量优化(老版本代码代码质量不好)，
1. sonarLint工具扫描，彻底解决代码质量问题
1. pom持续精简
1. flag改为Boolean类型
1. 所有DTO的swagger注释字段补全
1. tree型结构除了parentId机制以外，增加code表示tree的机制,以便于多级子节点查询
1. 可以不使用redis，缓存可以禁用
1. 测试用户登录并发控制功能:同一个用户不同机器同时登录的个数的限制

### 新拟需求
1. filter层的统一异常
1. 单独使用TDF Common/Log/Security的sample模块
1. 所有配置包名，写死的地方需要改为支持用户动态修改。如log的切面和exception统一异常的切面，将"cn.com.taiji"移动到配置文件，支持用户自定义配置
1. @PreAuthorize("hasAuthority('" + TDFStatic.ROLE_ID_KEY + "')") 这种接口级权限做成动态可配置的。
1. 国际化目前不全面，应该全部静态字符串，使用静态变量国际化。
1. 使用 Undertow 替换 Tomcat
1. 统一测试校验 @Transactional , 保证事务生效
1. 统一测试缓存逻辑 @Cacheable , 保证缓存生效，缓存量正确，缓存生命周期正确。检查需要缓存的方法，增加缓存配置
1. 统一测试参数校验逻辑 @Valid , 统一使用Controller层的@Valid 优化精简其他层的校验逻辑

#### tdf-sample
1. 增加单独使用tdf-common、tdf-sys、单独使用tdf-security、单独使用tdf-log的sample示例。
1. config是否抽取，保持tdf入口类的简洁，config设置为默认配置，抽取公共配置，使得外部tdf-sample-jwt和tdf代码量最小，减少copy代码、维护两套相同代码难度。

#### 第一次汇报大家提出的问题汇总
1. 关于外键和级联、关联主键和复杂主键不是最佳实践的争议
1. TDFJpaQueryWord，是否是最佳实践
1. BaseDomain增加数据库校验,如果service层不做处理，可能不生效的问题
1. 是否使用@ApiOperationSupport(order = 1)代替默认的tag排序
1. StudentDTO的swagger要配置好，作为sample最佳实践示例。
1. 统一异常，不扩展Http状态码。已知的异常和可控的异常，未知的异常使用500。异常分类维度改为技术逻辑，而不是业务。
1. sample中增加普通分页自定义toSpecWithLogicType的示例
1. 所有接口的功能权限控制。


### 权限优化建议
分组(Group)和角色(Role)有什么区别？

角色是一组权限的集合。
分组侧重于管理用户，一个分组通常拥有多个角色，分组内的用户会继承分组内所有角色的所有权限。
常见的 Group 和 Role 示例：

Group
admin: 系统管理员，通常包含系统维护者。
employee: 正式雇员。
employer: 面试官。
hr
intern: 实习生
ops_engineer: 运维工程师
Role
Invoice Submitter: 具备发票报销的相关权限。
Vacation Requester: 具备申请假期的相关权限。
Corporation Email User: 具备使用公司邮箱的的相关权限。
Production Server Operator: 具备线上服务器的操作权限。
HR App User: 具备使用 HR 系统的相关权限。
举例来说：可以这样建立 Role 和 Group 之间的关系：

intern 具备 Corporation Email User 这个角色，但是不具备 Vacation Requester 和 Invoice Submitter 这两个